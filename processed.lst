 AS V1.42 Beta [Bld 157] - Source File processed.asm - Page 1 - 9/2/2020 12:10:51


       1/       0 :                      PAGE $0
       2/    1FFC :                      ORG $1FFC
       3/    1FFC : D5 13                FDB main
       4/       0 :                      ORG $0
       5/      20 :                      ORG $20
       6/      20 :                      
       7/      20 :                     dummy:
       8/      20 :                      DFS $1
       9/      21 :                      
      10/      21 :                     ret_val:
      11/      21 :                      DFS $2
      12/      23 :                      
      13/      23 :                     screen_ptr:
      14/      23 :                      DFS $2
      15/      25 :                      
      16/      25 :                     R0:
      17/      25 :                      DFS $9
      18/      2E :                      
      19/      2E :                     R1:
      20/      2E :                      DFS $9
      21/      37 :                      
      22/      37 :                     R2:
      23/      37 :                      DFS $9
      24/      40 :                      
      25/      40 :                     R3:
      26/      40 :                      DFS $9
      27/      49 :                      
      28/      49 :                     R4:
      29/      49 :                      DFS $9
      30/      52 :                      
      31/      52 :                     R5:
      32/      52 :                      DFS $9
      33/      5B :                      
      34/      5B :                     R6:
      35/      5B :                      DFS $9
      36/      64 :                      
      37/      64 :                     R7:
      38/      64 :                      DFS $9
      39/      6D :                     
      40/      6D :                     STACK_END:
      41/     130 :                      ORG $130
      42/     130 :                      
      43/     130 :                     global_error:
      44/     130 :                      DFS $1
      45/     131 :                      
      46/     131 :                     input_buff_begin:
      47/     131 :                      DFS $1
      48/     132 :                      
      49/     132 :                     input_buff_end:
      50/     132 :                      DFS $1
      51/     133 :                      
      52/     133 :                     input_buff:
      53/     133 :                      DFS $40
      54/     173 :                      
      55/     173 :                     new_word_len:
      56/     173 :                      DFS $1
      57/     174 :                      
      58/     174 :                     new_word_buff:
      59/     174 :                      DFS $13
      60/     187 :                      
      61/     187 :                     new_stack_item:
      62/     187 :                      DFS $9
      63/     190 :                      
      64/     190 :                     font_inverted:
      65/     190 :                      DFS $1
      66/     191 :                      
      67/     191 :                     stack_count:
      68/     191 :                      DFS $1
      69/     900 :                      ORG $900
      70/     900 : 4C D5 13             JMP main
      71/     903 :                      
      72/     903 :                     font_table:
      73/     903 : 00 00 00 00 00 00    FCB $0,$0,$0,$0,$0,$0,$0,$0
                    00 00             
      74/     90B : 30 78 78 30 30 00    FCB $30,$78,$78,$30,$30,$0,$30,$0
                    30 00             
      75/     913 : 6C 6C 6C 00 00 00    FCB $6C,$6C,$6C,$0,$0,$0,$0,$0
                    00 00             
      76/     91B : 6C 6C FE 6C FE 6C    FCB $6C,$6C,$FE,$6C,$FE,$6C,$6C,$0
                    6C 00             
      77/     923 : 30 7C C0 78 0C F8    FCB $30,$7C,$C0,$78,$C,$F8,$30,$0
                    30 00             
      78/     92B : 00 C6 CC 18 30 66    FCB $0,$C6,$CC,$18,$30,$66,$C6,$0
                    C6 00             
      79/     933 : 38 6C 38 76 DC CC    FCB $38,$6C,$38,$76,$DC,$CC,$76,$0
                    76 00             
      80/     93B : 60 60 C0 00 00 00    FCB $60,$60,$C0,$0,$0,$0,$0,$0
                    00 00             
      81/     943 : 18 30 60 60 60 30    FCB $18,$30,$60,$60,$60,$30,$18,$0
                    18 00             
      82/     94B : 60 30 18 18 18 30    FCB $60,$30,$18,$18,$18,$30,$60,$0
                    60 00             
      83/     953 : 00 66 3C FF 3C 66    FCB $0,$66,$3C,$FF,$3C,$66,$0,$0
                    00 00             
      84/     95B : 00 30 30 FC 30 30    FCB $0,$30,$30,$FC,$30,$30,$0,$0
                    00 00             
      85/     963 : 00 00 00 00 00 30    FCB $0,$0,$0,$0,$0,$30,$30,$60
                    30 60             
      86/     96B : 00 00 00 FC 00 00    FCB $0,$0,$0,$FC,$0,$0,$0,$0
                    00 00             
      87/     973 : 00 00 00 00 00 30    FCB $0,$0,$0,$0,$0,$30,$30,$0
                    30 00             
      88/     97B : 06 0C 18 30 60 C0    FCB $6,$C,$18,$30,$60,$C0,$80,$0
                    80 00             
      89/     983 : 7C C6 CE DE F6 E6    FCB $7C,$C6,$CE,$DE,$F6,$E6,$7C,$0
                    7C 00             
      90/     98B : 30 70 30 30 30 30    FCB $30,$70,$30,$30,$30,$30,$FC,$0
                    FC 00             
      91/     993 : 78 CC 0C 38 60 CC    FCB $78,$CC,$C,$38,$60,$CC,$FC,$0
                    FC 00             
      92/     99B : 78 CC 0C 38 0C CC    FCB $78,$CC,$C,$38,$C,$CC,$78,$0
                    78 00             
      93/     9A3 : 1C 3C 6C CC FE 0C    FCB $1C,$3C,$6C,$CC,$FE,$C,$1E,$0
                    1E 00             
      94/     9AB : FC C0 F8 0C 0C CC    FCB $FC,$C0,$F8,$C,$C,$CC,$78,$0
                    78 00             
      95/     9B3 : 38 60 C0 F8 CC CC    FCB $38,$60,$C0,$F8,$CC,$CC,$78,$0
                    78 00             
      96/     9BB : FC CC 0C 18 30 30    FCB $FC,$CC,$C,$18,$30,$30,$30,$0
                    30 00             
      97/     9C3 : 78 CC CC 78 CC CC    FCB $78,$CC,$CC,$78,$CC,$CC,$78,$0
                    78 00             
      98/     9CB : 78 CC CC 7C 0C 18    FCB $78,$CC,$CC,$7C,$C,$18,$70,$0
                    70 00             
      99/     9D3 : 00 30 30 00 00 30    FCB $0,$30,$30,$0,$0,$30,$30,$0
                    30 00             
     100/     9DB : 00 30 30 00 00 30    FCB $0,$30,$30,$0,$0,$30,$30,$60
                    30 60             
     101/     9E3 : 18 30 60 C0 60 30    FCB $18,$30,$60,$C0,$60,$30,$18,$0
                    18 00             
     102/     9EB : 00 00 FC 00 00 FC    FCB $0,$0,$FC,$0,$0,$FC,$0,$0
                    00 00             
     103/     9F3 : 60 30 18 0C 18 30    FCB $60,$30,$18,$C,$18,$30,$60,$0
                    60 00             
     104/     9FB : 78 CC 0C 18 30 00    FCB $78,$CC,$C,$18,$30,$0,$30,$0
                    30 00             
     105/     A03 : 7C C6 DE DE DE C0    FCB $7C,$C6,$DE,$DE,$DE,$C0,$78,$0
                    78 00             
     106/     A0B : 30 78 CC CC FC CC    FCB $30,$78,$CC,$CC,$FC,$CC,$CC,$0
                    CC 00             
     107/     A13 : FC 66 66 7C 66 66    FCB $FC,$66,$66,$7C,$66,$66,$FC,$0
                    FC 00             
     108/     A1B : 3C 66 C0 C0 C0 66    FCB $3C,$66,$C0,$C0,$C0,$66,$3C,$0
                    3C 00             
     109/     A23 : F8 6C 66 66 66 6C    FCB $F8,$6C,$66,$66,$66,$6C,$F8,$0
                    F8 00             
     110/     A2B : FE 62 68 78 68 62    FCB $FE,$62,$68,$78,$68,$62,$FE,$0
                    FE 00             
     111/     A33 : FE 62 68 78 68 60    FCB $FE,$62,$68,$78,$68,$60,$F0,$0
                    F0 00             
     112/     A3B : 3C 66 C0 C0 CE 66    FCB $3C,$66,$C0,$C0,$CE,$66,$3E,$0
                    3E 00             
     113/     A43 : CC CC CC FC CC CC    FCB $CC,$CC,$CC,$FC,$CC,$CC,$CC,$0
                    CC 00             
     114/     A4B : 78 30 30 30 30 30    FCB $78,$30,$30,$30,$30,$30,$78,$0
                    78 00             
     115/     A53 : 1E 0C 0C 0C CC CC    FCB $1E,$C,$C,$C,$CC,$CC,$78,$0
                    78 00             
     116/     A5B : E6 66 6C 78 6C 66    FCB $E6,$66,$6C,$78,$6C,$66,$E6,$0
                    E6 00             
     117/     A63 : F0 60 60 60 62 66    FCB $F0,$60,$60,$60,$62,$66,$FE,$0
                    FE 00             
     118/     A6B : C6 EE FE FE D6 C6    FCB $C6,$EE,$FE,$FE,$D6,$C6,$C6,$0
                    C6 00             
     119/     A73 : C6 E6 F6 DE CE C6    FCB $C6,$E6,$F6,$DE,$CE,$C6,$C6,$0
                    C6 00             
     120/     A7B : 38 6C C6 C6 C6 6C    FCB $38,$6C,$C6,$C6,$C6,$6C,$38,$0
                    38 00             
     121/     A83 : FC 66 66 7C 60 60    FCB $FC,$66,$66,$7C,$60,$60,$F0,$0
                    F0 00             
     122/     A8B : 78 CC CC CC DC 78    FCB $78,$CC,$CC,$CC,$DC,$78,$1C,$0
                    1C 00             
     123/     A93 : FC 66 66 7C 6C 66    FCB $FC,$66,$66,$7C,$6C,$66,$E6,$0
                    E6 00             
     124/     A9B : 78 CC E0 70 1C CC    FCB $78,$CC,$E0,$70,$1C,$CC,$78,$0
                    78 00             
     125/     AA3 : FC B4 30 30 30 30    FCB $FC,$B4,$30,$30,$30,$30,$78,$0
                    78 00             
     126/     AAB : CC CC CC CC CC CC    FCB $CC,$CC,$CC,$CC,$CC,$CC,$FC,$0
                    FC 00             
     127/     AB3 : CC CC CC CC CC 78    FCB $CC,$CC,$CC,$CC,$CC,$78,$30,$0
                    30 00             
     128/     ABB : C6 C6 C6 D6 FE EE    FCB $C6,$C6,$C6,$D6,$FE,$EE,$C6,$0
                    C6 00             
     129/     AC3 : C6 C6 6C 38 38 6C    FCB $C6,$C6,$6C,$38,$38,$6C,$C6,$0
                    C6 00             
     130/     ACB : CC CC CC 78 30 30    FCB $CC,$CC,$CC,$78,$30,$30,$78,$0
                    78 00             
     131/     AD3 : FE C6 8C 18 32 66    FCB $FE,$C6,$8C,$18,$32,$66,$FE,$0
                    FE 00             
     132/     ADB : 78 60 60 60 60 60    FCB $78,$60,$60,$60,$60,$60,$78,$0
                    78 00             
     133/     AE3 : C0 60 30 18 0C 06    FCB $C0,$60,$30,$18,$C,$6,$2,$0
                    02 00             
     134/     AEB : 78 18 18 18 18 18    FCB $78,$18,$18,$18,$18,$18,$78,$0
                    78 00             
     135/     AF3 : 10 38 6C C6 00 00    FCB $10,$38,$6C,$C6,$0,$0,$0,$0
                    00 00             
     136/     AFB : 00 00 00 00 00 00    FCB $0,$0,$0,$0,$0,$0,$0,$FF
                    00 FF             
     137/     B03 : FF FF FF FF FF FF    FCB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                    FF FF             
     138/     B0B : 08 18 38 78 38 18    FCB $8,$18,$38,$78,$38,$18,$8,$0
                    08 00             
     139/     B13 : 00 00 00 00 FF FF    FCB $0,$0,$0,$0,$FF,$FF,$FF,$FF
                    FF FF             
     140/     B1B : 00 1E 00 00 00 00    FCB $0,$1E,$0,$0,$0,$0,$0,$0
                    00 00             
     141/     B23 : FF FF FF FF FF FF    FCB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
                    FF FF             
     142/     B2B : 00 00 EE 88 EE 88    FCB $0,$0,$EE,$88,$EE,$88,$EE,$0
                    EE 00             
     143/     B33 :                      
     144/     B33 :                     setup:
     145/     B33 : 78                   SEI
     146/     B34 : D8                   CLD
     147/     B35 : A2 00                LDX #$0
     148/     B37 : 8E 91 01             STX stack_count
     149/     B3A : A9 00                LDA #$0
     150/     B3C : 8D 90 01             STA font_inverted
     151/     B3F : A9 04                LDA #$4
     152/     B41 : 8D E1 FF             STA $FFE1
     153/     B44 : A9 05                LDA #$5
     154/     B46 : 8D E2 FF             STA $FFE2
     155/     B49 : 60                   RTS
     156/     B4A :                      
     157/     B4A :                     ReadKey:
     158/     B4A : AD E4 FF             LDA $FFE4
     159/     B4D : 60                   RTS
     160/     B4E :                      
     161/     B4E :                     LCD_clrscr:
     162/     B4E : A9 00                LDA #$0
     163/     B50 : 85 23                STA screen_ptr
     164/     B52 : A9 40                LDA #$40
     165/     B54 : 85 24                STA screen_ptr+$1
     166/     B56 : A9 80                LDA #$80
     167/     B58 : 85 07                STA $7 ;counter
     168/     B5A : A9 2A                LDA #$2A
     169/     B5C : A0 00                LDY #$0
     170/     B5E :                      .loop:
     171/     B5E : 91 23                STA (screen_ptr),Y
     172/     B60 : C8                   INY
     173/     B61 : D0 FB                BNE .loop
     174/     B63 : E6 24                INC screen_ptr+$1
     175/     B65 : C6 07                DEC $7 ;counter
     176/     B67 : D0 F5                BNE .loop
     177/     B69 : A9 00                LDA #$0
     178/     B6B : 85 23                STA screen_ptr
     179/     B6D : A9 40                LDA #$40
     180/     B6F : 85 24                STA screen_ptr+$1
     181/     B71 : 60                   RTS
     182/     B72 :                      
     183/     B72 :                     LCD_char:
     184/     B72 : A5 0F                LDA $F ;c_out
     185/     B74 : C9 20                CMP #$20
     186/     B76 : 90 03                BCC .._98.skip
     187/     B78 : 4C 7C 0B             JMP .if0
     188/     B7B :                      .._98.skip:
     189/     B7B : 60                   RTS
     190/     B7C :                      .if0:
     191/     B7C : C9 66                CMP #$66
     192/     B7E : B0 03                BCS .._103.skip
     193/     B80 : 4C 84 0B             JMP .if1
     194/     B83 :                      .._103.skip:
     195/     B83 : 60                   RTS
     196/     B84 :                      .if1:
     197/     B84 : 38                   SEC
     198/     B85 : E9 20                SBC #$20
     199/     B87 : 85 10                STA $10 ;pixel_ptr
     200/     B89 : A9 00                LDA #$0
     201/     B8B : 85 11                STA $11 ;pixel_ptr
     202/     B8D : 06 10                ASL $10 ;pixel_ptr
     203/     B8F : 06 10                ASL $10 ;pixel_ptr
     204/     B91 : 26 11                ROL $11 ;pixel_ptr
     205/     B93 : 06 10                ASL $10 ;pixel_ptr
     206/     B95 : 26 11                ROL $11 ;pixel_ptr
     207/     B97 : A9 03                LDA #font_table # $100
     208/     B99 : 65 10                ADC $10 ;pixel_ptr
     209/     B9B : 85 10                STA $10 ;pixel_ptr
     210/     B9D : A9 09                LDA #font_table/$100
     211/     B9F : 65 11                ADC $11 ;pixel_ptr
     212/     BA1 : 85 11                STA $11 ;pixel_ptr
     213/     BA3 : A9 00                LDA #$0
     214/     BA5 : 85 12                STA $12 ;pixel_index
     215/     BA7 : A9 08                LDA #$8
     216/     BA9 : 85 14                STA $14 ;lc1
     217/     BAB :                      .loop:
     218/     BAB : A9 08                LDA #$8
     219/     BAD : 85 15                STA $15 ;lc2
     220/     BAF : A4 12                LDY $12 ;pixel_index
     221/     BB1 : E6 12                INC $12 ;pixel_index
     222/     BB3 : B1 10                LDA ($10),Y ;pixel_ptr
     223/     BB5 : 4D 90 01             EOR font_inverted
     224/     BB8 : 85 13                STA $13 ;pixel
     225/     BBA : A0 00                LDY #$0
     226/     BBC :                      .loop.inner:
     227/     BBC : 26 13                ROL $13 ;pixel
     228/     BBE : A9 00                LDA #$0
     229/     BC0 : B0 02                BCS .color
     230/     BC2 : A9 2A                LDA #$2A
     231/     BC4 :                      .color:
     232/     BC4 : 91 23                STA (screen_ptr),Y
     233/     BC6 : E6 24                INC screen_ptr+$1
     234/     BC8 : 91 23                STA (screen_ptr),Y
     235/     BCA : C8                   INY
     236/     BCB : 91 23                STA (screen_ptr),Y
     237/     BCD : C6 24                DEC screen_ptr+$1
     238/     BCF : 91 23                STA (screen_ptr),Y
     239/     BD1 : C8                   INY
     240/     BD2 : C6 15                DEC $15 ;lc2
     241/     BD4 : D0 E6                BNE .loop.inner
     242/     BD6 : E6 24                INC screen_ptr+$1
     243/     BD8 : E6 24                INC screen_ptr+$1
     244/     BDA : C6 14                DEC $14 ;lc1
     245/     BDC : D0 CD                BNE .loop
     246/     BDE : 18                   CLC
     247/     BDF : A5 23                LDA screen_ptr
     248/     BE1 : 69 10                ADC #$10
     249/     BE3 : 85 23                STA screen_ptr
     250/     BE5 : 38                   SEC
     251/     BE6 : A5 24                LDA screen_ptr+$1
     252/     BE8 : E9 10                SBC #$10
     253/     BEA : 85 24                STA screen_ptr+$1
     254/     BEC : 60                   RTS
     255/     BED :                      
     256/     BED :                     LCD_print:
     257/     BED : A9 00                LDA #$0
     258/     BEF : 85 09                STA $9 ;index
     259/     BF1 :                      .loop:
     260/     BF1 : A4 09                LDY $9 ;index
     261/     BF3 : B1 07                LDA ($7),Y ;source
     262/     BF5 : F0 0E                BEQ .done
     263/     BF7 : 85 0A                STA $A ;arg
     264/     BF9 : A5 0A                LDA $A ;arg
     265/     BFB : 85 0F                STA $F ;LCD_char.c_out
     266/     BFD : 20 72 0B             JSR LCD_char
     267/     C00 : E6 09                INC $9 ;index
     268/     C02 : 4C F1 0B             JMP .loop
     269/     C05 :                      .done:
     270/     C05 : 60                   RTS
     271/     C06 :                      
     272/     C06 :                     MemCopy:
     273/     C06 : A0 00                LDY #$0
     274/     C08 :                      .loop:
     275/     C08 : B1 0E                LDA ($E),Y ;source
     276/     C0A : 91 10                STA ($10),Y ;dest
     277/     C0C : C8                   INY
     278/     C0D : C4 12                CPY $12 ;count
     279/     C0F : D0 F7                BNE .loop
     280/     C11 : 60                   RTS
     281/     C12 :                      
     282/     C12 :                     BCD_Reverse:
     283/     C12 : A0 00                LDY #$0
     284/     C14 : F8                   SED
     285/     C15 : 38                   SEC
     286/     C16 :                      .loop:
     287/     C16 : A9 00                LDA #$0
     288/     C18 : F1 0E                SBC ($E),Y ;source
     289/     C1A : 91 0E                STA ($E),Y ;source
     290/     C1C : C8                   INY
     291/     C1D : C6 10                DEC $10 ;count
     292/     C1F : D0 F5                BNE .loop
     293/     C21 : D8                   CLD
     294/     C22 : 60                   RTS
     295/     C23 :                      
     296/     C23 :                     DigitHigh:
     297/     C23 : A5 0E                LDA $E ;digit
     298/     C25 : 4A                   LSR
     299/     C26 : 4A                   LSR
     300/     C27 : 4A                   LSR
     301/     C28 : 4A                   LSR
     302/     C29 : 18                   CLC
     303/     C2A : 69 30                ADC #$30
     304/     C2C : 85 0E                STA $E ;digit
     305/     C2E : A5 0E                LDA $E ;digit
     306/     C30 : 85 0F                STA $F ;LCD_char.c_out
     307/     C32 : 20 72 0B             JSR LCD_char
     308/     C35 : 60                   RTS
     309/     C36 :                      
     310/     C36 :                     DigitLow:
     311/     C36 : A5 0E                LDA $E ;digit
     312/     C38 : 29 0F                AND #$F
     313/     C3A : 18                   CLC
     314/     C3B : 69 30                ADC #$30
     315/     C3D : 85 0E                STA $E ;digit
     316/     C3F : A5 0E                LDA $E ;digit
     317/     C41 : 85 0F                STA $F ;LCD_char.c_out
     318/     C43 : 20 72 0B             JSR LCD_char
     319/     C46 : 60                   RTS
     320/     C47 :                      
     321/     C47 :                     DrawFloat:
     322/     C47 : A5 07                LDA $7 ;source
     323/     C49 : 85 0E                STA $E ;MemCopy.source
     324/     C4B : A5 08                LDA $8 ;source
     325/     C4D : 85 0F                STA $F ;MemCopy.source
     326/     C4F : A9 25                LDA # (R0) # $100
     327/     C51 : 85 10                STA $10 ;MemCopy.dest
     328/     C53 : A9 00                LDA # (R0)/$100
     329/     C55 : 85 11                STA $11 ;MemCopy.dest
     330/     C57 : A9 09                LDA #$9
     331/     C59 : 85 12                STA $12 ;MemCopy.count
     332/     C5B : 20 06 0C             JSR MemCopy
     333/     C5E : A9 20                LDA #$20
     334/     C60 : 85 0B                STA $B ;sign
     335/     C62 : A0 06                LDY #$6
     336/     C64 : B1 07                LDA ($7),Y ;source
     337/     C66 : C9 50                CMP #$50
     338/     C68 : 90 13                BCC .positive
     339/     C6A : A9 2D                LDA #$2D
     340/     C6C : 85 0B                STA $B ;sign
     341/     C6E : A9 26                LDA # (R0+$1) # $100
     342/     C70 : 85 0E                STA $E ;BCD_Reverse.source
     343/     C72 : A9 00                LDA # (R0+$1)/$100
     344/     C74 : 85 0F                STA $F ;BCD_Reverse.source
     345/     C76 : A9 06                LDA #$6
     346/     C78 : 85 10                STA $10 ;BCD_Reverse.count
     347/     C7A : 20 12 0C             JSR BCD_Reverse
     348/     C7D :                      .positive:
     349/     C7D : A5 0B                LDA $B ;sign
     350/     C7F : 85 0F                STA $F ;LCD_char.c_out
     351/     C81 : 20 72 0B             JSR LCD_char
     352/     C84 : A0 06                LDY #$6
     353/     C86 : B9 25 00             LDA R0,Y
     354/     C89 : 85 0A                STA $A ;arg
     355/     C8B : A5 0A                LDA $A ;arg
     356/     C8D : 85 0E                STA $E ;DigitHigh.digit
     357/     C8F : 20 23 0C             JSR DigitHigh
     358/     C92 : A9 2E                LDA #$2E
     359/     C94 : 85 0F                STA $F ;LCD_char.c_out
     360/     C96 : 20 72 0B             JSR LCD_char
     361/     C99 : A5 0A                LDA $A ;arg
     362/     C9B : 85 0E                STA $E ;DigitLow.digit
     363/     C9D : 20 36 0C             JSR DigitLow
     364/     CA0 : A9 05                LDA #$5
     365/     CA2 : 85 09                STA $9 ;index
     366/     CA4 :                      .loop:
     367/     CA4 : A4 09                LDY $9 ;index
     368/     CA6 : B9 25 00             LDA R0,Y
     369/     CA9 : 85 0A                STA $A ;arg
     370/     CAB : A5 0A                LDA $A ;arg
     371/     CAD : 85 0E                STA $E ;DigitHigh.digit
     372/     CAF : 20 23 0C             JSR DigitHigh
     373/     CB2 : A5 0A                LDA $A ;arg
     374/     CB4 : 85 0E                STA $E ;DigitLow.digit
     375/     CB6 : 20 36 0C             JSR DigitLow
     376/     CB9 : C6 09                DEC $9 ;index
     377/     CBB : A5 09                LDA $9 ;index
     378/     CBD : C9 02                CMP #$2
     379/     CBF : D0 E3                BNE .loop
     380/     CC1 : A9 2B                LDA #$2B
     381/     CC3 : 85 0B                STA $B ;sign
     382/     CC5 : A0 08                LDY #$8
     383/     CC7 : B1 07                LDA ($7),Y ;source
     384/     CC9 : C9 50                CMP #$50
     385/     CCB : 90 13                BCC .positive_e
     386/     CCD : A9 2D                LDA #$2D
     387/     CCF : 85 0B                STA $B ;sign
     388/     CD1 : A9 2C                LDA # (R0+$7) # $100
     389/     CD3 : 85 0E                STA $E ;BCD_Reverse.source
     390/     CD5 : A9 00                LDA # (R0+$7)/$100
     391/     CD7 : 85 0F                STA $F ;BCD_Reverse.source
     392/     CD9 : A9 02                LDA #$2
     393/     CDB : 85 10                STA $10 ;BCD_Reverse.count
     394/     CDD : 20 12 0C             JSR BCD_Reverse
     395/     CE0 :                      .positive_e:
     396/     CE0 : A5 0B                LDA $B ;sign
     397/     CE2 : 85 0F                STA $F ;LCD_char.c_out
     398/     CE4 : 20 72 0B             JSR LCD_char
     399/     CE7 : A0 08                LDY #$8
     400/     CE9 : B9 25 00             LDA R0,Y
     401/     CEC : 85 0A                STA $A ;arg
     402/     CEE : A5 0A                LDA $A ;arg
     403/     CF0 : 85 0E                STA $E ;DigitLow.digit
     404/     CF2 : 20 36 0C             JSR DigitLow
     405/     CF5 : A0 07                LDY #$7
     406/     CF7 : B9 25 00             LDA R0,Y
     407/     CFA : 85 0A                STA $A ;arg
     408/     CFC : A5 0A                LDA $A ;arg
     409/     CFE : 85 0E                STA $E ;DigitHigh.digit
     410/     D00 : 20 23 0C             JSR DigitHigh
     411/     D03 : A5 0A                LDA $A ;arg
     412/     D05 : 85 0E                STA $E ;DigitLow.digit
     413/     D07 : 20 36 0C             JSR DigitLow
     414/     D0A : 60                   RTS
     415/     D0B :                      
     416/     D0B :                     HexHigh:
     417/     D0B : A5 0A                LDA $A ;digit
     418/     D0D : 4A                   LSR
     419/     D0E : 4A                   LSR
     420/     D0F : 4A                   LSR
     421/     D10 : 4A                   LSR
     422/     D11 : C9 0A                CMP #$A
     423/     D13 : 90 08                BCC .print_digit
     424/     D15 : 18                   CLC
     425/     D16 : 69 37                ADC #$37
     426/     D18 : 85 0B                STA $B ;arg
     427/     D1A : 4C 22 0D             JMP .done
     428/     D1D :                      .print_digit:
     429/     D1D : 18                   CLC
     430/     D1E : 69 30                ADC #$30
     431/     D20 : 85 0B                STA $B ;arg
     432/     D22 :                      .done:
     433/     D22 : A5 0B                LDA $B ;arg
     434/     D24 : 85 0F                STA $F ;LCD_char.c_out
     435/     D26 : 20 72 0B             JSR LCD_char
     436/     D29 : 60                   RTS
     437/     D2A :                      
     438/     D2A :                     HexLow:
     439/     D2A : A5 0A                LDA $A ;digit
     440/     D2C : 29 0F                AND #$F
     441/     D2E : C9 0A                CMP #$A
     442/     D30 : 90 08                BCC .print_digit
     443/     D32 : 18                   CLC
     444/     D33 : 69 37                ADC #$37
     445/     D35 : 85 0B                STA $B ;arg
     446/     D37 : 4C 3F 0D             JMP .done
     447/     D3A :                      .print_digit:
     448/     D3A : 18                   CLC
     449/     D3B : 69 30                ADC #$30
     450/     D3D : 85 0B                STA $B ;arg
     451/     D3F :                      .done:
     452/     D3F : A5 0B                LDA $B ;arg
     453/     D41 : 85 0F                STA $F ;LCD_char.c_out
     454/     D43 : 20 72 0B             JSR LCD_char
     455/     D46 : 60                   RTS
     456/     D47 :                      
     457/     D47 :                     DrawHex:
     458/     D47 : A9 24                LDA #$24
     459/     D49 : 85 0F                STA $F ;LCD_char.c_out
     460/     D4B : 20 72 0B             JSR LCD_char
     461/     D4E : A0 02                LDY #$2
     462/     D50 : B1 07                LDA ($7),Y ;source
     463/     D52 : 85 09                STA $9 ;arg
     464/     D54 : A5 09                LDA $9 ;arg
     465/     D56 : 85 0A                STA $A ;HexHigh.digit
     466/     D58 : 20 0B 0D             JSR HexHigh
     467/     D5B : A5 09                LDA $9 ;arg
     468/     D5D : 85 0A                STA $A ;HexLow.digit
     469/     D5F : 20 2A 0D             JSR HexLow
     470/     D62 : A0 01                LDY #$1
     471/     D64 : B1 07                LDA ($7),Y ;source
     472/     D66 : 85 09                STA $9 ;arg
     473/     D68 : A5 09                LDA $9 ;arg
     474/     D6A : 85 0A                STA $A ;HexHigh.digit
     475/     D6C : 20 0B 0D             JSR HexHigh
     476/     D6F : A5 09                LDA $9 ;arg
     477/     D71 : 85 0A                STA $A ;HexLow.digit
     478/     D73 : 20 2A 0D             JSR HexLow
     479/     D76 : 60                   RTS
     480/     D77 :                      
     481/     D77 :                     DrawString:
     482/     D77 : A9 22                LDA #$22
     483/     D79 : 85 0F                STA $F ;LCD_char.c_out
     484/     D7B : 20 72 0B             JSR LCD_char
     485/     D7E : A9 01                LDA #$1
     486/     D80 : 85 0A                STA $A ;index
     487/     D82 :                      .loop:
     488/     D82 : A4 0A                LDY $A ;index
     489/     D84 : B1 07                LDA ($7),Y ;source
     490/     D86 : F0 11                BEQ .done
     491/     D88 : 85 09                STA $9 ;arg
     492/     D8A : A5 09                LDA $9 ;arg
     493/     D8C : 85 0F                STA $F ;LCD_char.c_out
     494/     D8E : 20 72 0B             JSR LCD_char
     495/     D91 : E6 0A                INC $A ;index
     496/     D93 : A5 0A                LDA $A ;index
     497/     D95 : C9 09                CMP #$9
     498/     D97 : D0 E9                BNE .loop
     499/     D99 :                      .done:
     500/     D99 : A9 22                LDA #$22
     501/     D9B : 85 0F                STA $F ;LCD_char.c_out
     502/     D9D : 20 72 0B             JSR LCD_char
     503/     DA0 : 60                   RTS
     504/     DA1 :                      
     505/     DA1 :                     DrawStack:
     506/     DA1 : 8A                   TXA
     507/     DA2 : 18                   CLC
     508/     DA3 : 69 24                ADC #$24
     509/     DA5 : 85 05                STA $5 ;address
     510/     DA7 : A9 00                LDA #$0
     511/     DA9 : 85 06                STA $6 ;address
     512/     DAB : 20 4E 0B             JSR LCD_clrscr
     513/     DAE : 4C B5 0D             JMP .._913.str_skip
     514/     DB1 :                      .._913.str_addr:
     515/     DB1 : 52 41 44 00          FCB "RAD",$0
     516/     DB5 :                      .._913.str_skip:
     517/     DB5 : A9 B1                LDA # (.._913.str_addr) # $100
     518/     DB7 : 85 07                STA $7 ;LCD_print.source
     519/     DB9 : A9 0D                LDA # (.._913.str_addr)/$100
     520/     DBB : 85 08                STA $8 ;LCD_print.source
     521/     DBD : 20 ED 0B             JSR LCD_print
     522/     DC0 : A9 35                LDA #$35
     523/     DC2 : 85 03                STA $3 ;character
     524/     DC4 : A9 05                LDA #$5
     525/     DC6 : 85 04                STA $4 ;counter
     526/     DC8 :                      .loop:
     527/     DC8 : A9 00                LDA #$0
     528/     DCA : 85 23                STA screen_ptr
     529/     DCC : A5 24                LDA screen_ptr+$1
     530/     DCE : 18                   CLC
     531/     DCF : 69 10                ADC #$10
     532/     DD1 : 85 24                STA screen_ptr+$1
     533/     DD3 : A5 03                LDA $3 ;character
     534/     DD5 : 85 0F                STA $F ;LCD_char.c_out
     535/     DD7 : 20 72 0B             JSR LCD_char
     536/     DDA : A9 3A                LDA #$3A
     537/     DDC : 85 0F                STA $F ;LCD_char.c_out
     538/     DDE : 20 72 0B             JSR LCD_char
     539/     DE1 : C6 04                DEC $4 ;counter
     540/     DE3 : A5 04                LDA $4 ;counter
     541/     DE5 : CD 91 01             CMP stack_count
     542/     DE8 : B0 3A                BCS .no_item
     543/     DEA : A0 00                LDY #$0
     544/     DEC : B1 05                LDA ($5),Y ;address
     545/     DEE : C9 01                CMP #$1
     546/     DF0 : D0 0E                BNE .not_float
     547/     DF2 : A5 05                LDA $5 ;address
     548/     DF4 : 85 07                STA $7 ;DrawFloat.source
     549/     DF6 : A5 06                LDA $6 ;address
     550/     DF8 : 85 08                STA $8 ;DrawFloat.source
     551/     DFA : 20 47 0C             JSR DrawFloat
     552/     DFD : 4C 24 0E             JMP .item_done
     553/     E00 :                      .not_float:
     554/     E00 : C9 02                CMP #$2
     555/     E02 : D0 0E                BNE .not_str
     556/     E04 : A5 05                LDA $5 ;address
     557/     E06 : 85 07                STA $7 ;DrawString.source
     558/     E08 : A5 06                LDA $6 ;address
     559/     E0A : 85 08                STA $8 ;DrawString.source
     560/     E0C : 20 77 0D             JSR DrawString
     561/     E0F : 4C 24 0E             JMP .item_done
     562/     E12 :                      .not_str:
     563/     E12 : C9 03                CMP #$3
     564/     E14 : D0 0E                BNE .not_hex
     565/     E16 : A5 05                LDA $5 ;address
     566/     E18 : 85 07                STA $7 ;DrawHex.source
     567/     E1A : A5 06                LDA $6 ;address
     568/     E1C : 85 08                STA $8 ;DrawHex.source
     569/     E1E : 20 47 0D             JSR DrawHex
     570/     E21 : 4C 24 0E             JMP .item_done
     571/     E24 :                      .not_hex:
     572/     E24 :                      .item_done:
     573/     E24 :                      .no_item:
     574/     E24 : A5 05                LDA $5 ;address
     575/     E26 : 38                   SEC
     576/     E27 : E9 09                SBC #$9
     577/     E29 : 85 05                STA $5 ;address
     578/     E2B : C6 03                DEC $3 ;character
     579/     E2D : A5 04                LDA $4 ;counter
     580/     E2F : D0 97                BNE .loop
     581/     E31 : A9 00                LDA #$0
     582/     E33 : 85 23                STA screen_ptr
     583/     E35 : A5 24                LDA screen_ptr+$1
     584/     E37 : 18                   CLC
     585/     E38 : 69 14                ADC #$14
     586/     E3A : 85 24                STA screen_ptr+$1
     587/     E3C : A0 00                LDY #$0
     588/     E3E : A9 00                LDA #$0
     589/     E40 :                      .loop_line:
     590/     E40 : 91 23                STA (screen_ptr),Y
     591/     E42 : E6 24                INC screen_ptr+$1
     592/     E44 : 91 23                STA (screen_ptr),Y
     593/     E46 : C6 24                DEC screen_ptr+$1
     594/     E48 : C8                   INY
     595/     E49 : D0 F5                BNE .loop_line
     596/     E4B : 60                   RTS
     597/     E4C :                      
     598/     E4C :                     ERROR_MSG_INPUT:
     599/     E4C : 49 4E 50 55 54 20    FCB "INPUT ERROR ",$0
                    45 52 52 4F 52 20 
                    00                
     600/     E59 :                      
     601/     E59 :                     ERROR_MSG_WORD_TOO_LONG:
     602/     E59 : 49 4E 50 55 54 20    FCB "INPUT SIZE  ",$0
                    53 49 5A 45 20 20 
                    00                
     603/     E66 :                      
     604/     E66 :                     ERROR_MSG_STRING:
     605/     E66 : 53 54 52 49 4E 47    FCB "STRING ERROR",$0
                    20 45 52 52 4F 52 
                    00                
     606/     E73 :                      
     607/     E73 :                     ERROR_MSG_STACK_OVERFLOW:
     608/     E73 : 53 54 41 43 4B 20    FCB "STACK OVERF ",$0
                    4F 56 45 52 46 20 
                    00                
     609/     E80 :                      
     610/     E80 :                     ERROR_MSG_STACK_UNDERFLOW:
     611/     E80 : 53 54 41 43 4B 20    FCB "STACK UNDERF",$0
                    55 4E 44 45 52 46 
                    00                
     612/     E8D :                      
     613/     E8D :                     ERROR_TABLE:
     614/     E8D : 4C 0E                FDB ERROR_MSG_INPUT
     615/     E8F : 59 0E                FDB ERROR_MSG_WORD_TOO_LONG
     616/     E91 : 66 0E                FDB ERROR_MSG_STRING
     617/     E93 : 73 0E                FDB ERROR_MSG_STACK_OVERFLOW
     618/     E95 : 80 0E                FDB ERROR_MSG_STACK_UNDERFLOW
     619/     E97 :                      
     620/     E97 :                     ErrorMsg:
     621/     E97 : A4 03                LDY $3 ;error_code
     622/     E99 : B9 8B 0E             LDA ERROR_TABLE-$2,Y
     623/     E9C : 85 04                STA $4 ;msg
     624/     E9E : B9 8C 0E             LDA ERROR_TABLE-$1,Y
     625/     EA1 : 85 05                STA $5 ;msg
     626/     EA3 : A9 20                LDA #$20
     627/     EA5 : 85 23                STA screen_ptr
     628/     EA7 : A9 60                LDA #$60
     629/     EA9 : 85 24                STA screen_ptr+$1
     630/     EAB : 4C BB 0E             JMP .._1088.str_skip
     631/     EAE :                      .._1088.str_addr:
     632/     EAE : 62 62 62 62 62 62    FCB "bbbbbbbbbbbb",$0
                    62 62 62 62 62 62 
                    00                
     633/     EBB :                      .._1088.str_skip:
     634/     EBB : A9 AE                LDA # (.._1088.str_addr) # $100
     635/     EBD : 85 07                STA $7 ;LCD_print.source
     636/     EBF : A9 0E                LDA # (.._1088.str_addr)/$100
     637/     EC1 : 85 08                STA $8 ;LCD_print.source
     638/     EC3 : 20 ED 0B             JSR LCD_print
     639/     EC6 : A9 20                LDA #$20
     640/     EC8 : 85 23                STA screen_ptr
     641/     ECA : A9 70                LDA #$70
     642/     ECC : 85 24                STA screen_ptr+$1
     643/     ECE : A9 FF                LDA #$FF
     644/     ED0 : 8D 90 01             STA font_inverted
     645/     ED3 : A5 04                LDA $4 ;msg
     646/     ED5 : 85 07                STA $7 ;LCD_print.source
     647/     ED7 : A5 05                LDA $5 ;msg
     648/     ED9 : 85 08                STA $8 ;LCD_print.source
     649/     EDB : 20 ED 0B             JSR LCD_print
     650/     EDE : A9 20                LDA #$20
     651/     EE0 : 85 23                STA screen_ptr
     652/     EE2 : A9 80                LDA #$80
     653/     EE4 : 85 24                STA screen_ptr+$1
     654/     EE6 : 4C F6 0E             JMP .._1142.str_skip
     655/     EE9 :                      .._1142.str_addr:
     656/     EE9 : 62 62 62 62 62 62    FCB "bbbbbbbbbbbb",$0
                    62 62 62 62 62 62 
                    00                
     657/     EF6 :                      .._1142.str_skip:
     658/     EF6 : A9 E9                LDA # (.._1142.str_addr) # $100
     659/     EF8 : 85 07                STA $7 ;LCD_print.source
     660/     EFA : A9 0E                LDA # (.._1142.str_addr)/$100
     661/     EFC : 85 08                STA $8 ;LCD_print.source
     662/     EFE : 20 ED 0B             JSR LCD_print
     663/     F01 : A9 00                LDA #$0
     664/     F03 : 8D 90 01             STA font_inverted
     665/     F06 :                      .loop:
     666/     F06 : 20 4A 0B             JSR ReadKey
     667/     F09 : C9 0D                CMP #$D
     668/     F0B : D0 F9                BNE .loop
     669/     F0D : 60                   RTS
     670/     F0E : 60                   RTS
     671/     F0F :                      
     672/     F0F :                     InitForth:
     673/     F0F : A9 00                LDA #$0
     674/     F11 : 8D 31 01             STA input_buff_begin
     675/     F14 : 8D 32 01             STA input_buff_end
     676/     F17 : 8D 73 01             STA new_word_len
     677/     F1A : 60                   RTS
     678/     F1B :                      
     679/     F1B :                     special_chars:
     680/     F1B : 65 22                FCB 'e',$22
     681/     F1D : 20 2E 24 6D          FCB " .$m"
     682/     F21 :                      
     683/     F21 :                     ReadLine:
     684/     F21 : A9 00                LDA #$0
     685/     F23 : 85 03                STA $3 ;cursor
     686/     F25 : 85 06                STA $6 ;index
     687/     F27 : 85 23                STA screen_ptr
     688/     F29 : A9 AC                LDA #$AC
     689/     F2B : 85 24                STA screen_ptr+$1
     690/     F2D : 4C 41 0F             JMP .._1193.str_skip
     691/     F30 :                      .._1193.str_addr:
     692/     F30 : 61 20 20 20 20 20    FCB "a               ",$0
                    20 20 20 20 20 20 
                    20 20 20 20 00    
     693/     F41 :                      .._1193.str_skip:
     694/     F41 : A9 30                LDA # (.._1193.str_addr) # $100
     695/     F43 : 85 07                STA $7 ;LCD_print.source
     696/     F45 : A9 0F                LDA # (.._1193.str_addr)/$100
     697/     F47 : 85 08                STA $8 ;LCD_print.source
     698/     F49 : 20 ED 0B             JSR LCD_print
     699/     F4C : AD E6 FF             LDA $FFE6
     700/     F4F : 85 04                STA $4 ;cursor_timer
     701/     F51 :                      .loop:
     702/     F51 : A9 00                LDA #$0
     703/     F53 : 85 05                STA $5 ;arg
     704/     F55 : 20 4A 0B             JSR ReadKey
     705/     F58 : D0 03                BNE .key_read
     706/     F5A : 4C 3A 10             JMP .no_key
     707/     F5D :                      .key_read:
     708/     F5D : C9 0D                CMP #$D
     709/     F5F : D0 0F                BNE .not_enter
     710/     F61 : A5 06                LDA $6 ;index
     711/     F63 : F0 EC                BEQ .loop
     712/     F65 : A9 00                LDA #$0
     713/     F67 : 8D 31 01             STA input_buff_begin
     714/     F6A : A5 06                LDA $6 ;index
     715/     F6C : 8D 32 01             STA input_buff_end
     716/     F6F : 60                   RTS
     717/     F70 :                      .not_enter:
     718/     F70 : C9 08                CMP #$8
     719/     F72 : D0 2F                BNE .not_backspace
     720/     F74 : A5 06                LDA $6 ;index
     721/     F76 : F0 28                BEQ .backspace_done
     722/     F78 : C6 06                DEC $6 ;index
     723/     F7A : C9 10                CMP #$10
     724/     F7C : B0 1C                BCS .backspace_scroll
     725/     F7E : A9 20                LDA #$20
     726/     F80 : 85 0F                STA $F ;LCD_char.c_out
     727/     F82 : 20 72 0B             JSR LCD_char
     728/     F85 : A5 23                LDA screen_ptr
     729/     F87 : 38                   SEC
     730/     F88 : E9 20                SBC #$20
     731/     F8A : 85 23                STA screen_ptr
     732/     F8C : 48                   PHA
     733/     F8D : A9 61                LDA #$61
     734/     F8F : 85 0F                STA $F ;LCD_char.c_out
     735/     F91 : 20 72 0B             JSR LCD_char
     736/     F94 : 68                   PLA
     737/     F95 : 85 23                STA screen_ptr
     738/     F97 : 4C 3A 10             JMP .draw_done
     739/     F9A :                      .backspace_scroll:
     740/     F9A : A4 06                LDY $6 ;index
     741/     F9C : 88                   DEY
     742/     F9D : 4C 0D 10             JMP .scroll_buffer
     743/     FA0 :                      .backspace_done:
     744/     FA0 : 4C 3A 10             JMP .no_key
     745/     FA3 :                      .not_backspace:
     746/     FA3 : A0 00                LDY #$0
     747/     FA5 :                      .special_loop:
     748/     FA5 : D9 1B 0F             CMP special_chars,Y
     749/     FA8 : D0 0D                BNE .special_next
     750/     FAA : 85 05                STA $5 ;arg
     751/     FAC : C9 6D                CMP #$6D
     752/     FAE : D0 33                BNE .key_done
     753/     FB0 : A9 63                LDA #$63
     754/     FB2 : 85 05                STA $5 ;arg
     755/     FB4 : 4C E3 0F             JMP .key_done
     756/     FB7 :                      .special_next:
     757/     FB7 : C8                   INY
     758/     FB8 : C0 06                CPY #$6
     759/     FBA : D0 E9                BNE .special_loop
     760/     FBC : C9 30                CMP #$30
     761/     FBE : 90 09                BCC .not_num
     762/     FC0 : C9 3A                CMP #$3A
     763/     FC2 : B0 05                BCS .not_num
     764/     FC4 : 85 05                STA $5 ;arg
     765/     FC6 : 4C E3 0F             JMP .key_done
     766/     FC9 :                      .not_num:
     767/     FC9 : C9 41                CMP #$41
     768/     FCB : 90 09                BCC .not_upper
     769/     FCD : C9 5B                CMP #$5B
     770/     FCF : B0 05                BCS .not_upper
     771/     FD1 : 85 05                STA $5 ;arg
     772/     FD3 : 4C E3 0F             JMP .key_done
     773/     FD6 :                      .not_upper:
     774/     FD6 : C9 61                CMP #$61
     775/     FD8 : 90 09                BCC .not_lower
     776/     FDA : C9 7B                CMP #$7B
     777/     FDC : B0 05                BCS .not_lower
     778/     FDE : 38                   SEC
     779/     FDF : E9 20                SBC #$20
     780/     FE1 : 85 05                STA $5 ;arg
     781/     FE3 :                      .not_lower:
     782/     FE3 :                      .key_done:
     783/     FE3 : A5 05                LDA $5 ;arg
     784/     FE5 : F0 53                BEQ .not_valid
     785/     FE7 : A4 06                LDY $6 ;index
     786/     FE9 : C0 40                CPY #$40
     787/     FEB : B0 4D                BCS .buffer_full
     788/     FED : 99 33 01             STA input_buff,Y
     789/     FF0 : E6 06                INC $6 ;index
     790/     FF2 : C0 0F                CPY #$F
     791/     FF4 : B0 17                BCS .scroll_buffer
     792/     FF6 : A5 05                LDA $5 ;arg
     793/     FF8 : 85 0F                STA $F ;LCD_char.c_out
     794/     FFA : 20 72 0B             JSR LCD_char
     795/     FFD : A5 23                LDA screen_ptr
     796/     FFF : 48                   PHA
     797/    1000 : A9 61                LDA #$61
     798/    1002 : 85 0F                STA $F ;LCD_char.c_out
     799/    1004 : 20 72 0B             JSR LCD_char
     800/    1007 : 68                   PLA
     801/    1008 : 85 23                STA screen_ptr
     802/    100A : 4C 3A 10             JMP .draw_done
     803/    100D :                      .scroll_buffer:
     804/    100D : A9 00                LDA #$0
     805/    100F : 85 23                STA screen_ptr
     806/    1011 : 98                   TYA
     807/    1012 : 38                   SEC
     808/    1013 : E9 0E                SBC #$E
     809/    1015 : 85 0B                STA $B ;str_index
     810/    1017 :                      .scroll_loop:
     811/    1017 : A4 0B                LDY $B ;str_index
     812/    1019 : E6 0B                INC $B ;str_index
     813/    101B : B9 33 01             LDA input_buff,Y
     814/    101E : 85 05                STA $5 ;arg
     815/    1020 : A5 05                LDA $5 ;arg
     816/    1022 : 85 0F                STA $F ;LCD_char.c_out
     817/    1024 : 20 72 0B             JSR LCD_char
     818/    1027 : A5 06                LDA $6 ;index
     819/    1029 : C5 0B                CMP $B ;str_index
     820/    102B : D0 EA                BNE .scroll_loop
     821/    102D : A5 23                LDA screen_ptr
     822/    102F : 48                   PHA
     823/    1030 : A9 61                LDA #$61
     824/    1032 : 85 0F                STA $F ;LCD_char.c_out
     825/    1034 : 20 72 0B             JSR LCD_char
     826/    1037 : 68                   PLA
     827/    1038 : 85 23                STA screen_ptr
     828/    103A :                      .draw_done:
     829/    103A :                      .buffer_full:
     830/    103A :                      .not_valid:
     831/    103A :                      .no_key:
     832/    103A : AD E6 FF             LDA $FFE6
     833/    103D : C5 04                CMP $4 ;cursor_timer
     834/    103F : F0 25                BEQ .cursor_done
     835/    1041 : 85 04                STA $4 ;cursor_timer
     836/    1043 : A5 03                LDA $3 ;cursor
     837/    1045 : F0 09                BEQ .draw_blank
     838/    1047 : A9 00                LDA #$0
     839/    1049 : 85 03                STA $3 ;cursor
     840/    104B : A9 20                LDA #$20
     841/    104D : 4C 56 10             JMP .draw
     842/    1050 :                      .draw_blank:
     843/    1050 : A9 FF                LDA #$FF
     844/    1052 : 85 03                STA $3 ;cursor
     845/    1054 : A9 61                LDA #$61
     846/    1056 :                      .draw:
     847/    1056 : 85 05                STA $5 ;arg
     848/    1058 : A5 05                LDA $5 ;arg
     849/    105A : 85 0F                STA $F ;LCD_char.c_out
     850/    105C : 20 72 0B             JSR LCD_char
     851/    105F : A5 23                LDA screen_ptr
     852/    1061 : 38                   SEC
     853/    1062 : E9 10                SBC #$10
     854/    1064 : 85 23                STA screen_ptr
     855/    1066 :                      .cursor_done:
     856/    1066 : 4C 51 0F             JMP .loop
     857/    1069 : 60                   RTS
     858/    106A :                      
     859/    106A :                     LineWord:
     860/    106A : A9 00                LDA #$0
     861/    106C : 85 21                STA ret_val
     862/    106E : A9 00                LDA #$0
     863/    1070 : 8D 73 01             STA new_word_len
     864/    1073 : AC 31 01             LDY input_buff_begin
     865/    1076 : CC 32 01             CPY input_buff_end
     866/    1079 : D0 01                BNE .chars_left
     867/    107B : 60                   RTS
     868/    107C :                      .chars_left:
     869/    107C :                      .loop:
     870/    107C : AC 31 01             LDY input_buff_begin
     871/    107F : B9 33 01             LDA input_buff,Y
     872/    1082 : EE 31 01             INC input_buff_begin
     873/    1085 : C9 20                CMP #$20
     874/    1087 : D0 06                BNE .not_space
     875/    1089 : AD 73 01             LDA new_word_len
     876/    108C : F0 14                BEQ .chars_left2
     877/    108E : 60                   RTS
     878/    108F :                      .not_space:
     879/    108F : AC 73 01             LDY new_word_len
     880/    1092 : 99 74 01             STA new_word_buff,Y
     881/    1095 : C8                   INY
     882/    1096 : 8C 73 01             STY new_word_len
     883/    1099 : C0 13                CPY #$13
     884/    109B : D0 05                BNE .word_size_good
     885/    109D : A9 04                LDA #$4
     886/    109F : 85 21                STA ret_val
     887/    10A1 : 60                   RTS
     888/    10A2 :                      .word_size_good:
     889/    10A2 :                      .chars_left2:
     890/    10A2 : AD 31 01             LDA input_buff_begin
     891/    10A5 : CD 32 01             CMP input_buff_end
     892/    10A8 : F0 03                BEQ .found
     893/    10AA : 4C 7C 10             JMP .loop
     894/    10AD :                      .found:
     895/    10AD : 60                   RTS
     896/    10AE : 60                   RTS
     897/    10AF :                      
     898/    10AF :                     FindWord:
     899/    10AF : A9 0F                LDA # (FORTH_WORDS) # $100
     900/    10B1 : 85 21                STA ret_val
     901/    10B3 : A9 13                LDA # (FORTH_WORDS)/$100
     902/    10B5 : 85 22                STA ret_val+$1
     903/    10B7 :                      .loop:
     904/    10B7 : A0 00                LDY #$0
     905/    10B9 : B1 21                LDA (ret_val),Y
     906/    10BB : CD 73 01             CMP new_word_len
     907/    10BE : D0 11                BNE .loop_next
     908/    10C0 : C8                   INY
     909/    10C1 :                      .str_loop:
     910/    10C1 : B1 21                LDA (ret_val),Y
     911/    10C3 : D9 73 01             CMP new_word_buff-$1,Y
     912/    10C6 : D0 09                BNE .no_match
     913/    10C8 : CC 73 01             CPY new_word_len
     914/    10CB : F0 1C                BEQ .word_found
     915/    10CD : C8                   INY
     916/    10CE : 4C C1 10             JMP .str_loop
     917/    10D1 :                      .no_match:
     918/    10D1 :                      .loop_next:
     919/    10D1 : A0 00                LDY #$0
     920/    10D3 : B1 21                LDA (ret_val),Y
     921/    10D5 : A8                   TAY
     922/    10D6 : C8                   INY
     923/    10D7 : B1 21                LDA (ret_val),Y
     924/    10D9 : 48                   PHA
     925/    10DA : C8                   INY
     926/    10DB : B1 21                LDA (ret_val),Y
     927/    10DD : 85 22                STA ret_val+$1
     928/    10DF : 68                   PLA
     929/    10E0 : 85 21                STA ret_val
     930/    10E2 : 05 22                ORA ret_val+$1
     931/    10E4 : D0 D1                BNE .loop
     932/    10E6 : 85 21                STA ret_val
     933/    10E8 : 60                   RTS
     934/    10E9 :                      .word_found:
     935/    10E9 : A0 00                LDY #$0
     936/    10EB : B1 21                LDA (ret_val),Y
     937/    10ED : A8                   TAY
     938/    10EE : C8                   INY
     939/    10EF : C8                   INY
     940/    10F0 : C8                   INY
     941/    10F1 : B1 21                LDA (ret_val),Y
     942/    10F3 : 85 21                STA ret_val
     943/    10F5 : 60                   RTS
     944/    10F6 :                      
     945/    10F6 :                     CheckData:
     946/    10F6 : A9 04                LDA #$4
     947/    10F8 : 8D 87 01             STA new_stack_item
     948/    10FB : AD 73 01             LDA new_word_len
     949/    10FE : D0 01                BNE .not_zero_len
     950/    1100 : 60                   RTS
     951/    1101 :                      .not_zero_len:
     952/    1101 : A0 08                LDY #$8
     953/    1103 : A9 00                LDA #$0
     954/    1105 :                      .zero_loop:
     955/    1105 : 99 87 01             STA new_stack_item,Y
     956/    1108 : 88                   DEY
     957/    1109 : D0 FA                BNE .zero_loop
     958/    110B : A0 00                LDY #$0
     959/    110D : AD 74 01             LDA new_word_buff
     960/    1110 : C9 22                CMP #$22
     961/    1112 : D0 2E                BNE .not_string
     962/    1114 : AD 73 01             LDA new_word_len
     963/    1117 : C9 01                CMP #$1
     964/    1119 : D0 01                BNE .not_single_quote
     965/    111B : 60                   RTS
     966/    111C :                      .not_single_quote:
     967/    111C : CE 73 01             DEC new_word_len
     968/    111F :                      .loop_str:
     969/    111F : B9 75 01             LDA new_word_buff+$1,y
     970/    1122 : C9 22                CMP #$22
     971/    1124 : F0 10                BEQ .str_done
     972/    1126 : C0 08                CPY #$8
     973/    1128 : F0 0B                BEQ .string_too_long
     974/    112A : 99 88 01             STA new_stack_item+$1,Y
     975/    112D : C8                   INY
     976/    112E : CC 73 01             CPY new_word_len
     977/    1131 : F0 02                BEQ .string_unterminated
     978/    1133 : D0 EA                BNE .loop_str
     979/    1135 :                      .string_too_long:
     980/    1135 :                      .string_unterminated:
     981/    1135 : 60                   RTS
     982/    1136 :                      .str_done:
     983/    1136 : C8                   INY
     984/    1137 : CC 73 01             CPY new_word_len
     985/    113A : D0 05                BNE .str_return
     986/    113C : A9 02                LDA #$2
     987/    113E : 8D 87 01             STA new_stack_item
     988/    1141 :                      .str_return:
     989/    1141 : 60                   RTS
     990/    1142 :                      .not_string:
     991/    1142 : C9 24                CMP #$24
     992/    1144 : D0 4F                BNE .not_hex
     993/    1146 : AD 73 01             LDA new_word_len
     994/    1149 : C9 01                CMP #$1
     995/    114B : F0 47                BEQ .hex_error
     996/    114D : C9 06                CMP #$6
     997/    114F : B0 43                BCS .hex_error
     998/    1151 : CE 73 01             DEC new_word_len
     999/    1154 : A0 00                LDY #$0
    1000/    1156 :                      .loop_hex:
    1001/    1156 : B9 75 01             LDA new_word_buff+$1,Y
    1002/    1159 : C9 30                CMP #$30
    1003/    115B : 90 37                BCC .hex_error
    1004/    115D : C9 3A                CMP #$3A
    1005/    115F : B0 0F                BCS .not_digit
    1006/    1161 : 38                   SEC
    1007/    1162 : E9 30                SBC #$30
    1008/    1164 : 20 7D 12             JSR .hex_rotate
    1009/    1167 : 0D 88 01             ORA new_stack_item+$1
    1010/    116A : 8D 88 01             STA new_stack_item+$1
    1011/    116D : 4C 84 11             JMP .hex_char_next
    1012/    1170 :                      .not_digit:
    1013/    1170 : C9 41                CMP #$41
    1014/    1172 : 90 20                BCC .hex_error
    1015/    1174 : C9 47                CMP #$47
    1016/    1176 : B0 1C                BCS .hex_error
    1017/    1178 : 38                   SEC
    1018/    1179 : E9 37                SBC #$37
    1019/    117B : 20 7D 12             JSR .hex_rotate
    1020/    117E : 0D 88 01             ORA new_stack_item+$1
    1021/    1181 : 8D 88 01             STA new_stack_item+$1
    1022/    1184 :                      .hex_char_next:
    1023/    1184 : C8                   INY
    1024/    1185 : CC 73 01             CPY new_word_len
    1025/    1188 : F0 04                BEQ .hex_done
    1026/    118A : C0 04                CPY #$4
    1027/    118C : D0 C8                BNE .loop_hex
    1028/    118E :                      .hex_done:
    1029/    118E : A9 03                LDA #$3
    1030/    1190 : 8D 87 01             STA new_stack_item
    1031/    1193 : 60                   RTS
    1032/    1194 :                      .hex_error:
    1033/    1194 : 60                   RTS
    1034/    1195 :                      .not_hex:
    1035/    1195 : A9 06                LDA #$6
    1036/    1197 : 85 05                STA $5 ;index
    1037/    1199 : A9 00                LDA #$0
    1038/    119B : 85 06                STA $6 ;which_digit
    1039/    119D : 85 07                STA $7 ;negative
    1040/    119F : 85 08                STA $8 ;exp_negative
    1041/    11A1 : 85 09                STA $9 ;exp_count
    1042/    11A3 : 85 0D                STA $D ;digit_count
    1043/    11A5 : 85 0C                STA $C ;nonzero_found
    1044/    11A7 : 85 0B                STA $B ;dec_found
    1045/    11A9 : 85 0A                STA $A ;exp_found
    1046/    11AB : AD 74 01             LDA new_word_buff
    1047/    11AE : C9 63                CMP #$63
    1048/    11B0 : D0 05                BNE .float_no_neg
    1049/    11B2 : A9 FF                LDA #$FF
    1050/    11B4 : 85 07                STA $7 ;negative
    1051/    11B6 : C8                   INY
    1052/    11B7 :                      .float_no_neg:
    1053/    11B7 :                      .loop_float:
    1054/    11B7 : B9 74 01             LDA new_word_buff,Y
    1055/    11BA : 20 8D 12             JSR .digit
    1056/    11BD : 90 60                BCC .float_not_digit
    1057/    11BF : 48                   PHA
    1058/    11C0 : A5 0C                LDA $C ;nonzero_found
    1059/    11C2 : D0 17                BNE .digit_good
    1060/    11C4 : 68                   PLA
    1061/    11C5 : 48                   PHA
    1062/    11C6 : F0 06                BEQ .digit_zero
    1063/    11C8 : A9 FF                LDA #$FF
    1064/    11CA : 85 0C                STA $C ;nonzero_found
    1065/    11CC : D0 0D                BNE .digit_good
    1066/    11CE :                      .digit_zero:
    1067/    11CE : 68                   PLA
    1068/    11CF : A5 0A                LDA $A ;exp_found
    1069/    11D1 : D0 1E                BNE .float_next
    1070/    11D3 : A5 0B                LDA $B ;dec_found
    1071/    11D5 : F0 1A                BEQ .float_next
    1072/    11D7 : C6 09                DEC $9 ;exp_count
    1073/    11D9 : D0 16                BNE .float_next
    1074/    11DB :                      .digit_good:
    1075/    11DB : A5 0A                LDA $A ;exp_found
    1076/    11DD : D0 1B                BNE .exp_digit
    1077/    11DF : A5 0D                LDA $D ;digit_count
    1078/    11E1 : C9 0C                CMP #$C
    1079/    11E3 : D0 02                BNE .digit_ok
    1080/    11E5 : 68                   PLA
    1081/    11E6 : 60                   RTS
    1082/    11E7 :                      .digit_ok:
    1083/    11E7 : A5 0B                LDA $B ;dec_found
    1084/    11E9 : D0 02                BNE .no_dec_yet
    1085/    11EB : E6 09                INC $9 ;exp_count
    1086/    11ED :                      .no_dec_yet:
    1087/    11ED : 68                   PLA
    1088/    11EE : 20 9A 12             JSR .add_digit
    1089/    11F1 :                      .float_next:
    1090/    11F1 : C8                   INY
    1091/    11F2 : CC 73 01             CPY new_word_len
    1092/    11F5 : F0 6B                BEQ .float_done
    1093/    11F7 : 4C B7 11             JMP .loop_float
    1094/    11FA :                      .exp_digit:
    1095/    11FA : A5 0D                LDA $D ;digit_count
    1096/    11FC : C9 03                CMP #$3
    1097/    11FE : D0 02                BNE .exp_digit_ok
    1098/    1200 : 68                   PLA
    1099/    1201 : 60                   RTS
    1100/    1202 :                      .exp_digit_ok:
    1101/    1202 : 68                   PLA
    1102/    1203 : 84 04                STY $4 ;y_buff
    1103/    1205 : A0 04                LDY #$4
    1104/    1207 :                      .exp_loop:
    1105/    1207 : 0E 8E 01             ASL new_stack_item+$7
    1106/    120A : 2E 8F 01             ROL new_stack_item+$8
    1107/    120D : 88                   DEY
    1108/    120E : D0 F7                BNE .exp_loop
    1109/    1210 : A4 04                LDY $4 ;y_buff
    1110/    1212 : 0D 8E 01             ORA new_stack_item+$7
    1111/    1215 : 8D 8E 01             STA new_stack_item+$7
    1112/    1218 : E6 05                INC $5 ;index
    1113/    121A : E6 0D                INC $D ;digit_count
    1114/    121C : 4C F1 11             JMP .float_next
    1115/    121F :                      .float_not_digit:
    1116/    121F : C9 2E                CMP #$2E
    1117/    1221 : D0 10                BNE .not_decimal_point
    1118/    1223 : A5 0B                LDA $B ;dec_found
    1119/    1225 : F0 01                BEQ .decimal_good
    1120/    1227 : 60                   RTS
    1121/    1228 :                      .decimal_good:
    1122/    1228 : A5 0A                LDA $A ;exp_found
    1123/    122A : F0 01                BEQ .exp_good
    1124/    122C : 60                   RTS
    1125/    122D :                      .exp_good:
    1126/    122D : A9 FF                LDA #$FF
    1127/    122F : 85 0B                STA $B ;dec_found
    1128/    1231 : D0 BE                BNE .float_next
    1129/    1233 :                      .not_decimal_point:
    1130/    1233 : C9 65                CMP #$65
    1131/    1235 : D0 15                BNE .not_exp
    1132/    1237 : A5 0A                LDA $A ;exp_found
    1133/    1239 : F0 01                BEQ .first_exp
    1134/    123B : 60                   RTS
    1135/    123C :                      .first_exp:
    1136/    123C : A9 00                LDA #$0
    1137/    123E : 85 05                STA $5 ;index
    1138/    1240 : 85 06                STA $6 ;which_digit
    1139/    1242 : 85 0D                STA $D ;digit_count
    1140/    1244 : 85 0C                STA $C ;nonzero_found
    1141/    1246 : A9 FF                LDA #$FF
    1142/    1248 : 85 0A                STA $A ;exp_found
    1143/    124A : D0 A5                BNE .float_next
    1144/    124C :                      .not_exp:
    1145/    124C : C9 63                CMP #$63
    1146/    124E : D0 11                BNE .not_minus
    1147/    1250 : A5 0A                LDA $A ;exp_found
    1148/    1252 : 49 FF                EOR #$FF
    1149/    1254 : 05 05                ORA $5 ;index
    1150/    1256 : 05 08                ORA $8 ;exp_negative
    1151/    1258 : F0 01                BEQ .minus_good
    1152/    125A : 60                   RTS
    1153/    125B :                      .minus_good:
    1154/    125B : A9 FF                LDA #$FF
    1155/    125D : 85 08                STA $8 ;exp_negative
    1156/    125F : D0 90                BNE .float_next
    1157/    1261 :                      .not_minus:
    1158/    1261 : 60                   RTS
    1159/    1262 :                      .float_done:
    1160/    1262 : A5 08                LDA $8 ;exp_negative
    1161/    1264 : F0 0F                BEQ .exp_not_negative
    1162/    1266 : A9 8E                LDA # (new_stack_item+$7) # $100
    1163/    1268 : 85 0E                STA $E ;BCD_Reverse.source
    1164/    126A : A9 01                LDA # (new_stack_item+$7)/$100
    1165/    126C : 85 0F                STA $F ;BCD_Reverse.source
    1166/    126E : A9 02                LDA #$2
    1167/    1270 : 85 10                STA $10 ;BCD_Reverse.count
    1168/    1272 : 20 12 0C             JSR BCD_Reverse
    1169/    1275 :                      .exp_not_negative:
    1170/    1275 : A5 09                LDA $9 ;exp_count
    1171/    1277 : A9 01                LDA #$1
    1172/    1279 : 8D 87 01             STA new_stack_item
    1173/    127C : 60                   RTS
    1174/    127D :                      .hex_rotate:
    1175/    127D : 84 04                STY $4 ;y_buff
    1176/    127F : A0 04                LDY #$4
    1177/    1281 :                      .hex_rot_loop:
    1178/    1281 : 0E 88 01             ASL new_stack_item+$1
    1179/    1284 : 2E 89 01             ROL new_stack_item+$2
    1180/    1287 : 88                   DEY
    1181/    1288 : D0 F7                BNE .hex_rot_loop
    1182/    128A : A4 04                LDY $4 ;y_buff
    1183/    128C : 60                   RTS
    1184/    128D :                      .digit:
    1185/    128D : C9 3A                CMP #$3A
    1186/    128F : B0 07                BCS .is_digit_no
    1187/    1291 : C9 30                CMP #$30
    1188/    1293 : 90 03                BCC .is_digit_no
    1189/    1295 : E9 30                SBC #$30
    1190/    1297 : 60                   RTS
    1191/    1298 :                      .is_digit_no:
    1192/    1298 : 18                   CLC
    1193/    1299 : 60                   RTS
    1194/    129A :                      .add_digit:
    1195/    129A : 48                   PHA
    1196/    129B : 84 04                STY $4 ;y_buff
    1197/    129D : A4 05                LDY $5 ;index
    1198/    129F : E6 0D                INC $D ;digit_count
    1199/    12A1 : A5 06                LDA $6 ;which_digit
    1200/    12A3 : 49 FF                EOR #$FF
    1201/    12A5 : 85 06                STA $6 ;which_digit
    1202/    12A7 : F0 0B                BEQ .second_digit
    1203/    12A9 : 68                   PLA
    1204/    12AA : 0A                   ASL
    1205/    12AB : 0A                   ASL
    1206/    12AC : 0A                   ASL
    1207/    12AD : 0A                   ASL
    1208/    12AE : 99 87 01             STA new_stack_item,Y
    1209/    12B1 : A4 04                LDY $4 ;y_buff
    1210/    12B3 : 60                   RTS
    1211/    12B4 :                      .second_digit:
    1212/    12B4 : 68                   PLA
    1213/    12B5 : 19 87 01             ORA new_stack_item,Y
    1214/    12B8 : 99 87 01             STA new_stack_item,Y
    1215/    12BB : C6 05                DEC $5 ;index
    1216/    12BD : A4 04                LDY $4 ;y_buff
    1217/    12BF : 60                   RTS
    1218/    12C0 : 60                   RTS
    1219/    12C1 :                      
    1220/    12C1 :                     ExecToken:
    1221/    12C1 : A9 00                LDA #$0
    1222/    12C3 : 85 21                STA ret_val
    1223/    12C5 : A4 03                LDY $3 ;token
    1224/    12C7 : B9 C5 13             LDA JUMP_TABLE,Y
    1225/    12CA : 85 06                STA $6 ;address
    1226/    12CC : B9 C6 13             LDA JUMP_TABLE+$1,Y
    1227/    12CF : 85 07                STA $7 ;address
    1228/    12D1 : A0 00                LDY #$0
    1229/    12D3 : B1 06                LDA ($6),Y ;address
    1230/    12D5 : F0 27                BEQ .no_flags
    1231/    12D7 : 85 04                STA $4 ;flags
    1232/    12D9 : 29 03                AND #$3
    1233/    12DB : 85 05                STA $5 ;temp
    1234/    12DD : AD 91 01             LDA stack_count
    1235/    12E0 : C5 05                CMP $5 ;temp
    1236/    12E2 : B0 05                BCS .no_underflow
    1237/    12E4 : A9 0A                LDA #$A
    1238/    12E6 : 85 21                STA ret_val
    1239/    12E8 : 60                   RTS
    1240/    12E9 :                      .no_underflow:
    1241/    12E9 : A5 04                LDA $4 ;flags
    1242/    12EB : 29 04                AND #$4
    1243/    12ED : F0 0F                BEQ .no_add_item
    1244/    12EF : A9 07                LDA #$7
    1245/    12F1 : CD 91 01             CMP stack_count
    1246/    12F4 : B0 05                BCS .no_overflow
    1247/    12F6 : A9 08                LDA #$8
    1248/    12F8 : 85 21                STA ret_val
    1249/    12FA : 60                   RTS
    1250/    12FB :                      .no_overflow:
    1251/    12FB : 20 06 13             JSR StackAddItem
    1252/    12FE :                      .no_add_item:
    1253/    12FE :                      .no_flags:
    1254/    12FE : A5 07                LDA $7 ;address
    1255/    1300 : 48                   PHA
    1256/    1301 : A5 06                LDA $6 ;address
    1257/    1303 : 48                   PHA
    1258/    1304 : 60                   RTS
    1259/    1305 : 60                   RTS
    1260/    1306 :                      
    1261/    1306 :                     StackAddItem:
    1262/    1306 : 8A                   TXA
    1263/    1307 : 38                   SEC
    1264/    1308 : E9 09                SBC #$9
    1265/    130A : AA                   TAX
    1266/    130B : EE 91 01             INC stack_count
    1267/    130E : 60                   RTS
    1268/    130F :                      
    1269/    130F :                     FORTH_WORDS:
    1270/    130F :                      
    1271/    130F :                     WORD_DUP:
    1272/    130F : 03 44 55 50          FCB $3,"DUP"
    1273/    1313 : 26 13                FDB WORD_SWAP
    1274/    1315 : 02                   FCB $2
    1275/    1316 :                      
    1276/    1316 :                     CODE_DUP:
    1277/    1316 : 05                   FCB $5
    1278/    1317 : A0 09                LDY #$9
    1279/    1319 : 8A                   TXA
    1280/    131A : 48                   PHA
    1281/    131B :                      .dup_loop:
    1282/    131B : B5 09                LDA $9,X
    1283/    131D : 95 00                STA $0,X
    1284/    131F : E8                   INX
    1285/    1320 : 88                   DEY
    1286/    1321 : D0 F8                BNE .dup_loop
    1287/    1323 : 68                   PLA
    1288/    1324 : AA                   TAX
    1289/    1325 : 60                   RTS
    1290/    1326 :                      
    1291/    1326 :                     WORD_SWAP:
    1292/    1326 : 04 53 57 41 50       FCB $4,"SWAP"
    1293/    132B : 44 13                FDB WORD_DROP
    1294/    132D : 04                   FCB $4
    1295/    132E :                      
    1296/    132E :                     CODE_SWAP:
    1297/    132E : 02                   FCB $2
    1298/    132F : A0 09                LDY #$9
    1299/    1331 : 8A                   TXA
    1300/    1332 : 48                   PHA
    1301/    1333 :                      .swap_loop:
    1302/    1333 : B5 09                LDA $9,X
    1303/    1335 : 48                   PHA
    1304/    1336 : B5 00                LDA $0,X
    1305/    1338 : 95 09                STA $9,X
    1306/    133A : 68                   PLA
    1307/    133B : 95 00                STA $0,X
    1308/    133D : E8                   INX
    1309/    133E : 88                   DEY
    1310/    133F : D0 F2                BNE .swap_loop
    1311/    1341 : 68                   PLA
    1312/    1342 : AA                   TAX
    1313/    1343 : 60                   RTS
    1314/    1344 :                      
    1315/    1344 :                     WORD_DROP:
    1316/    1344 : 04 44 52 4F 50       FCB $4,"DROP"
    1317/    1349 : 56 13                FDB WORD_OVER
    1318/    134B : 06                   FCB $6
    1319/    134C :                      
    1320/    134C :                     CODE_DROP:
    1321/    134C : 01                   FCB $1
    1322/    134D : 8A                   TXA
    1323/    134E : 18                   CLC
    1324/    134F : 69 09                ADC #$9
    1325/    1351 : AA                   TAX
    1326/    1352 : CE 91 01             DEC stack_count
    1327/    1355 : 60                   RTS
    1328/    1356 :                      
    1329/    1356 :                     WORD_OVER:
    1330/    1356 : 04 4F 56 45 52       FCB $4,"OVER"
    1331/    135B : 6E 13                FDB WORD_ROT
    1332/    135D : 08                   FCB $8
    1333/    135E :                      
    1334/    135E :                     CODE_OVER:
    1335/    135E : 06                   FCB $6
    1336/    135F : A0 09                LDY #$9
    1337/    1361 : 8A                   TXA
    1338/    1362 : 48                   PHA
    1339/    1363 :                      .over_loop:
    1340/    1363 : B5 12                LDA $12,X
    1341/    1365 : 95 00                STA $0,X
    1342/    1367 : E8                   INX
    1343/    1368 : 88                   DEY
    1344/    1369 : D0 F8                BNE .over_loop
    1345/    136B : 68                   PLA
    1346/    136C : AA                   TAX
    1347/    136D : 60                   RTS
    1348/    136E :                      
    1349/    136E :                     WORD_ROT:
    1350/    136E : 03 52 4F 54          FCB $3,"ROT"
    1351/    1372 : 91 13                FDB WORD_MIN_ROT
    1352/    1374 : 0A                   FCB $A
    1353/    1375 :                      
    1354/    1375 :                     CODE_ROT:
    1355/    1375 : 03                   FCB $3
    1356/    1376 : A0 09                LDY #$9
    1357/    1378 : 8A                   TXA
    1358/    1379 : 48                   PHA
    1359/    137A :                      .rot_loop:
    1360/    137A : B5 12                LDA $12,X
    1361/    137C : 48                   PHA
    1362/    137D : B5 09                LDA $9,X
    1363/    137F : 48                   PHA
    1364/    1380 : B5 00                LDA $0,X
    1365/    1382 : 95 09                STA $9,X
    1366/    1384 : 68                   PLA
    1367/    1385 : 95 12                STA $12,X
    1368/    1387 : 68                   PLA
    1369/    1388 : 95 00                STA $0,X
    1370/    138A : E8                   INX
    1371/    138B : 88                   DEY
    1372/    138C : D0 EC                BNE .rot_loop
    1373/    138E : 68                   PLA
    1374/    138F : AA                   TAX
    1375/    1390 : 60                   RTS
    1376/    1391 :                      
    1377/    1391 :                     WORD_MIN_ROT:
    1378/    1391 : 04 2D 52 4F 54       FCB $4,"-ROT"
    1379/    1396 : B5 13                FDB WORD_CLEAR
    1380/    1398 : 0C                   FCB $C
    1381/    1399 :                      
    1382/    1399 :                     CODE_MIN_ROT:
    1383/    1399 : 03                   FCB $3
    1384/    139A : A0 09                LDY #$9
    1385/    139C : 8A                   TXA
    1386/    139D : 48                   PHA
    1387/    139E :                      .min_rot_loop:
    1388/    139E : B5 12                LDA $12,X
    1389/    13A0 : 48                   PHA
    1390/    13A1 : B5 09                LDA $9,X
    1391/    13A3 : 48                   PHA
    1392/    13A4 : B5 00                LDA $0,X
    1393/    13A6 : 95 12                STA $12,X
    1394/    13A8 : 68                   PLA
    1395/    13A9 : 95 00                STA $0,X
    1396/    13AB : 68                   PLA
    1397/    13AC : 95 09                STA $9,X
    1398/    13AE : E8                   INX
    1399/    13AF : 88                   DEY
    1400/    13B0 : D0 EC                BNE .min_rot_loop
    1401/    13B2 : 68                   PLA
    1402/    13B3 : AA                   TAX
    1403/    13B4 : 60                   RTS
    1404/    13B5 :                      
    1405/    13B5 :                     WORD_CLEAR:
    1406/    13B5 : 05 43 4C 45 41 52    FCB $5,"CLEAR"
    1407/    13BB : 00 00                FDB $0
    1408/    13BD : 0E                   FCB $E
    1409/    13BE :                      
    1410/    13BE :                     CODE_CLEAR:
    1411/    13BE : 00                   FCB $0
    1412/    13BF : A2 00                LDX #$0
    1413/    13C1 : 8E 91 01             STX stack_count
    1414/    13C4 : 60                   RTS
    1415/    13C5 :                      
    1416/    13C5 :                     JUMP_TABLE:
    1417/    13C5 : 00 00                FDB $0
    1418/    13C7 : 16 13                FDB CODE_DUP
    1419/    13C9 : 2E 13                FDB CODE_SWAP
    1420/    13CB : 4C 13                FDB CODE_DROP
    1421/    13CD : 5E 13                FDB CODE_OVER
    1422/    13CF : 75 13                FDB CODE_ROT
    1423/    13D1 : 99 13                FDB CODE_MIN_ROT
    1424/    13D3 : BE 13                FDB CODE_CLEAR
    1425/    13D5 :                      
    1426/    13D5 :                     main:
    1427/    13D5 : A2 2F                LDX #$2F
    1428/    13D7 : 9A                   TXS
    1429/    13D8 : 20 33 0B             JSR setup
    1430/    13DB :                      .input_loop:
    1431/    13DB : 20 A1 0D             JSR DrawStack
    1432/    13DE : 20 21 0F             JSR ReadLine
    1433/    13E1 :                      .process_loop:
    1434/    13E1 : 20 6A 10             JSR LineWord
    1435/    13E4 : AD 73 01             LDA new_word_len
    1436/    13E7 : F0 F2                BEQ .input_loop
    1437/    13E9 : 20 AF 10             JSR FindWord
    1438/    13EC : A5 21                LDA ret_val
    1439/    13EE : F0 1A                BEQ .not_found
    1440/    13F0 : A5 21                LDA ret_val
    1441/    13F2 : 85 03                STA $3 ;ExecToken.token
    1442/    13F4 : 20 C1 12             JSR ExecToken
    1443/    13F7 : A5 21                LDA ret_val
    1444/    13F9 : F0 0C                BEQ .no_exec_error
    1445/    13FB : 85 02                STA $2 ;arg
    1446/    13FD : A5 02                LDA $2 ;arg
    1447/    13FF : 85 03                STA $3 ;ErrorMsg.error_code
    1448/    1401 : 20 97 0E             JSR ErrorMsg
    1449/    1404 : 4C DB 13             JMP .input_loop
    1450/    1407 :                      .no_exec_error:
    1451/    1407 : 4C E1 13             JMP .process_loop
    1452/    140A :                      .not_found:
    1453/    140A : 20 F6 10             JSR CheckData
    1454/    140D : AD 87 01             LDA new_stack_item
    1455/    1410 : C9 04                CMP #$4
    1456/    1412 : D0 0A                BNE .input_good
    1457/    1414 : A9 02                LDA #$2
    1458/    1416 : 85 03                STA $3 ;ErrorMsg.error_code
    1459/    1418 : 20 97 0E             JSR ErrorMsg
    1460/    141B : 4C DB 13             JMP .input_loop
    1461/    141E :                      .input_good:
    1462/    141E : A9 07                LDA #$7
    1463/    1420 : CD 91 01             CMP stack_count
    1464/    1423 : B0 0A                BCS .no_overflow
    1465/    1425 : A9 08                LDA #$8
    1466/    1427 : 85 03                STA $3 ;ErrorMsg.error_code
    1467/    1429 : 20 97 0E             JSR ErrorMsg
    1468/    142C : 4C DB 13             JMP .input_loop
    1469/    142F :                      .no_overflow:
    1470/    142F : 20 06 13             JSR StackAddItem
    1471/    1432 : 86 00                STX $0 ;dest
    1472/    1434 : A9 00                LDA #$0
    1473/    1436 : 85 01                STA $1 ;dest
    1474/    1438 : A9 87                LDA # (new_stack_item) # $100
    1475/    143A : 85 0E                STA $E ;MemCopy.source
    1476/    143C : A9 01                LDA # (new_stack_item)/$100
    1477/    143E : 85 0F                STA $F ;MemCopy.source
    1478/    1440 : A5 00                LDA $0 ;dest
    1479/    1442 : 85 10                STA $10 ;MemCopy.dest
    1480/    1444 : A5 01                LDA $1 ;dest
    1481/    1446 : 85 11                STA $11 ;MemCopy.dest
    1482/    1448 : A9 09                LDA #$9
    1483/    144A : 85 12                STA $12 ;MemCopy.count
    1484/    144C : 20 06 0C             JSR MemCopy
    1485/    144F : 4C E1 13             JMP .process_loop
    1486/    1452 : 60                   RTS
    1487/    1453 :                     
    1488/    1453 :                     
    1489/    1453 : =$1453              EEPROM set *
    1490/    1453 :                     
    1491/    1453 :                     	OUTRADIX 10
    1492/    1453 :                     
    1493/    1453 :                     AddCommas MACRO num
    1494/    1453 :                     comma_ret set "\{num}"
    1495/    1453 :                     	IF num<1000
    1496/    1453 :                     		EXITM
    1497/    1453 :                     	ELSE
    1498/    1453 :                     comma_ret set "\{substr(comma_ret,0,strlen(comma_ret)-3)},\{substr(comma_ret,strlen(comma_ret)-3,strlen(comma_ret))}"
    1499/    1453 :                     	ENDIF
    1500/    1453 :                     	ENDM
    1501/    1453 :                     
    1502/    1453 :                     ;Display memory usage in console
    1503/    1453 :                     ;===============================
 
    1504/    1453 :                     	MESSAGE " "
Memory usage
    1505/    1453 :                     	MESSAGE "Memory usage"
============
    1506/    1453 :                     	MESSAGE "============"
    1507/    1453 : (MACRO)             	AddCommas EEPROM-$900
    1507/    1453 : =2899               comma_ret set "\{EEPROM-$900}"
    1507/    1453 : =>FALSE                     IF EEPROM-$900<1000
    1507/    1453 :                                     EXITM
    1507/    1453 : =>TRUE                      ELSE
    1507/    1453 : =2,899              comma_ret set "\{substr(comma_ret,0,strlen(comma_ret)-3)},\{substr(comma_ret,strlen(comma_ret)-3,strlen(comma_ret))}"
    1507/    1453 : [1507]                      ENDIF
ROM size:	2,899 bytes (49%) of 5.75k bank
    1508/    1453 :                     	MESSAGE "ROM size:	\{comma_ret} bytes (\{100*(EEPROM-$900)/$1700}%) of 5.75k bank"
    1509/    1453 :                     	;AddCommas GENRAM-$200
    1510/    1453 :                     	;MESSAGE "RAM size:	\{comma_ret} bytes (\{100*(GENRAM-$200)/($4000-$200)}%) of 15.8k bank"
    1511/    1453 :                     	;Tell script that prints assembler output to stop outputting
    1512/    1453 :                     	;Eliminates double output (because of multiple passes???)
END
    1513/    1453 :                     	MESSAGE "END"
 AS V1.42 Beta [Bld 157] - Source File processed.asm - Page 2 - 9/2/2020 12:10:51


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :  i386-unknown-win32 - |  BCD_Reverse :                  C12 C |
 BCD_Reverse.loop :             C16 C | *BIGENDIAN :                      0 - |
*BRANCHEXT :                      0 - | *CASESENSITIVE :                  1 - |
 CODE_CLEAR :                  13BE C |  CODE_DROP :                   134C C |
 CODE_DUP :                    1316 C |  CODE_DUP.dup_loop :           131B C |
 CODE_MIN_ROT :                1399 C |  CODE_MIN_ROT.min_rot_loop :   139E C |
 CODE_OVER :                   135E C |  CODE_OVER.over_loop :         1363 C |
 CODE_ROT :                    1375 C |  CODE_ROT.rot_loop :           137A C |
 CODE_SWAP :                   132E C |  CODE_SWAP.swap_loop :         1333 C |
*CONSTPI :        3.141592653589793 - |  CheckData :                   10F6 C |
 CheckData.add_digit :         129A C |  CheckData.decimal_good :      1228 C |
 CheckData.digit :             128D C |  CheckData.digit_good :        11DB C |
 CheckData.digit_ok :          11E7 C |  CheckData.digit_zero :        11CE C |
 CheckData.exp_digit :         11FA C |  CheckData.exp_digit_ok :      1202 C |
 CheckData.exp_good :          122D C |  CheckData.exp_loop :          1207 C |
 CheckData.exp_not_negative :  1275 C |  CheckData.first_exp :         123C C |
 CheckData.float_done :        1262 C |  CheckData.float_next :        11F1 C |
 CheckData.float_no_neg :      11B7 C |  CheckData.float_not_digit :   121F C |
 CheckData.hex_char_next :     1184 C |  CheckData.hex_done :          118E C |
 CheckData.hex_error :         1194 C |  CheckData.hex_rot_loop :      1281 C |
 CheckData.hex_rotate :        127D C |  CheckData.is_digit_no :       1298 C |
 CheckData.loop_float :        11B7 C |  CheckData.loop_hex :          1156 C |
 CheckData.loop_str :          111F C |  CheckData.minus_good :        125B C |
 CheckData.no_dec_yet :        11ED C |  CheckData.not_decimal_point : 1233 C |
 CheckData.not_digit :         1170 C |  CheckData.not_exp :           124C C |
 CheckData.not_hex :           1195 C |  CheckData.not_minus :         1261 C |
 CheckData.not_single_quote :  111C C |  CheckData.not_string :        1142 C |
 CheckData.not_zero_len :      1101 C |  CheckData.second_digit :      12B4 C |
 CheckData.str_done :          1136 C |  CheckData.str_return :        1141 C |
 CheckData.string_too_long :   1135 C |
 CheckData.string_unterminated :                                       1135 C |
 CheckData.zero_loop :         1105 C | *DATE :                    9/2/2020 - |
 DigitHigh :                    C23 C |  DigitLow :                     C36 C |
 DrawFloat :                    C47 C |  DrawFloat.loop :               CA4 C |
 DrawFloat.positive :           C7D C |  DrawFloat.positive_e :         CE0 C |
 DrawHex :                      D47 C |  DrawStack :                    DA1 C |
 DrawStack.._913.str_addr :     DB1 C |  DrawStack.._913.str_skip :     DB5 C |
 DrawStack.item_done :          E24 C |  DrawStack.loop :               DC8 C |
 DrawStack.loop_line :          E40 C |  DrawStack.no_item :            E24 C |
 DrawStack.not_float :          E00 C |  DrawStack.not_hex :            E24 C |
 DrawStack.not_str :            E12 C |  DrawString :                   D77 C |
 DrawString.done :              D99 C |  DrawString.loop :              D82 C |
 EEPROM :                      1453 - |  ERROR_MSG_INPUT :              E4C C |
 ERROR_MSG_STACK_OVERFLOW :     E73 C |  ERROR_MSG_STACK_UNDERFLOW :    E80 C |
 ERROR_MSG_STRING :             E66 C |  ERROR_MSG_WORD_TOO_LONG :      E59 C |
 ERROR_TABLE :                  E8D C |  ErrorMsg :                     E97 C |
 ErrorMsg.._1088.str_addr :     EAE C |  ErrorMsg.._1088.str_skip :     EBB C |
 ErrorMsg.._1142.str_addr :     EE9 C |  ErrorMsg.._1142.str_skip :     EF6 C |
 ErrorMsg.loop :                F06 C |  ExecToken :                   12C1 C |
 ExecToken.no_add_item :       12FE C |  ExecToken.no_flags :          12FE C |
 ExecToken.no_overflow :       12FB C |  ExecToken.no_underflow :      12E9 C |
*FALSE :                          0 - |  FORTH_WORDS :                 130F C |
*FULLPMMU :                       1 - |  FindWord :                    10AF C |
 FindWord.loop :               10B7 C |  FindWord.loop_next :          10D1 C |
 FindWord.no_match :           10D1 C |  FindWord.str_loop :           10C1 C |
 FindWord.word_found :         10E9 C | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - |  HexHigh :                      D0B C |
 HexHigh.done :                 D22 C |  HexHigh.print_digit :          D1D C |
 HexLow :                       D2A C |  HexLow.done :                  D3F C |
 HexLow.print_digit :           D3A C | *INEXTMODE :                      0 - |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
*INSRCMODE :                      0 - | *INSUPMODE :                      0 - |
*InitForth :                    F0F C |  JUMP_TABLE :                  13C5 C |
 LCD_char :                     B72 C |  LCD_char.._103.skip :          B83 C |
 LCD_char.._98.skip :           B7B C |  LCD_char.color :               BC4 C |
 LCD_char.if0 :                 B7C C |  LCD_char.if1 :                 B84 C |
 LCD_char.loop :                BAB C |  LCD_char.loop.inner :          BBC C |
 LCD_clrscr :                   B4E C |  LCD_clrscr.loop :              B5E C |
 LCD_print :                    BED C |  LCD_print.done :               C05 C |
 LCD_print.loop :               BF1 C | *LISTON :                         1 - |
 LineWord :                    106A C |  LineWord.chars_left :         107C C |
 LineWord.chars_left2 :        10A2 C |  LineWord.found :              10AD C |
 LineWord.loop :               107C C |  LineWord.not_space :          108F C |
 LineWord.word_size_good :     10A2 C | *MACEXP :                         7 - |
*MOMCPU :                      6502 - | *MOMCPUNAME :                  6502 - |
 MemCopy :                      C06 C |  MemCopy.loop :                 C08 C |
*NESTMAX :                      100 - | *PACKING :                        0 - |
*PADDING :                        1 - |  R0 :                            25 C |
*R1 :                            2E C | *R2 :                            37 C |
*R3 :                            40 C | *R4 :                            49 C |
*R5 :                            52 C | *R6 :                            5B C |
*R7 :                            64 C | *RELAXED :                        0 - |
 ReadKey :                      B4A C |  ReadLine :                     F21 C |
 ReadLine.._1193.str_addr :     F30 C |  ReadLine.._1193.str_skip :     F41 C |
 ReadLine.backspace_done :      FA0 C |  ReadLine.backspace_scroll :    F9A C |
 ReadLine.buffer_full :        103A C |  ReadLine.cursor_done :        1066 C |
 ReadLine.draw :               1056 C |  ReadLine.draw_blank :         1050 C |
 ReadLine.draw_done :          103A C |  ReadLine.key_done :            FE3 C |
 ReadLine.key_read :            F5D C |  ReadLine.loop :                F51 C |
 ReadLine.no_key :             103A C |  ReadLine.not_backspace :       FA3 C |
 ReadLine.not_enter :           F70 C |  ReadLine.not_lower :           FE3 C |
 ReadLine.not_num :             FC9 C |  ReadLine.not_upper :           FD6 C |
 ReadLine.not_valid :          103A C |  ReadLine.scroll_buffer :      100D C |
 ReadLine.scroll_loop :        1017 C |  ReadLine.special_loop :        FA5 C |
 ReadLine.special_next :        FB7 C | *STACK_END :                     6D C |
 StackAddItem :                1306 C | *TIME :                    12:10:51 - |
*TRUE :                           1 - | *VERSION :                     142F - |
 WORD_CLEAR :                  13B5 C |  WORD_DROP :                   1344 C |
*WORD_DUP :                    130F C |  WORD_MIN_ROT :                1391 C |
 WORD_OVER :                   1356 C |  WORD_ROT :                    136E C |
 WORD_SWAP :                   1326 C |  comma_ret :                  2,899 - |
*dummy :                         20 C |  font_inverted :                190 C |
 font_table :                   903 C | *global_error :                 130 C |
 input_buff :                   133 C |  input_buff_begin :             131 C |
 input_buff_end :               132 C |  main :                        13D5 C |
 main.input_good :             141E C |  main.input_loop :             13DB C |
 main.no_exec_error :          1407 C |  main.no_overflow :            142F C |
 main.not_found :              140A C |  main.process_loop :           13E1 C |
 new_stack_item :               187 C |  new_word_buff :                174 C |
 new_word_len :                 173 C |  ret_val :                       21 C |
 screen_ptr :                    23 C |  setup :                        B33 C |
 special_chars :                F1B C |  stack_count :                  191 C |

    224 symbols
     40 unused symbols

 AS V1.42 Beta [Bld 157] - Source File processed.asm - Page 3 - 9/2/2020 12:10:51


  Defined Macros:
  ---------------

AddCommas                             |

      1 macro

 AS V1.42 Beta [Bld 157] - Source File processed.asm - Page 4 - 9/2/2020 12:10:51


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.03 seconds assembly time

   1513 lines source file
   1519 lines incl. macro expansions
      2 passes
      0 errors
      0 warnings
